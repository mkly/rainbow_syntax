window["Rainbow"]=function(){var replacements={},replacement_positions={},language_patterns={},bypass_defaults={},CURRENT_LEVEL=0,DEFAULT_LANGUAGE=0,match_counter=0,replacement_counter=0,global_class,onHighlight;function _attr(el,attr,attrs,i){var result=el.getAttribute&&el.getAttribute(attr)||0;if(!result){attrs=el.attributes;for(i=0;i<attrs.length;++i){if(attrs[i].nodeName===attr){return attrs[i].nodeValue}}}return result}function _addClass(el,class_name){el.className+=el.className?" "+class_name:class_name}function _hasClass(el,class_name){return(" "+el.className+" ").indexOf(" "+class_name+" ")>-1}function _getLanguageForBlock(block){var language=_attr(block,"data-language")||_attr(block.parentNode,"data-language");if(!language){var pattern=/\blang(?:uage)?-(\w+)/,match=block.className.match(pattern)||block.parentNode.className.match(pattern);if(match){language=match[1]}}return language}function _htmlEntities(code){return code.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&(?![\w\#]+;)/g,"&amp;")}function _intersects(start1,end1,start2,end2){if(start2>=start1&&start2<end1){return true}return end2>start1&&end2<end1}function _hasCompleteOverlap(start1,end1,start2,end2){if(start2==start1&&end2==end1){return false}return start2<=start1&&end2>=end1}function _matchIsInsideOtherMatch(start,end){for(var key in replacement_positions[CURRENT_LEVEL]){key=parseInt(key,10);if(_hasCompleteOverlap(key,replacement_positions[CURRENT_LEVEL][key],start,end)){delete replacement_positions[CURRENT_LEVEL][key];delete replacements[CURRENT_LEVEL][key]}if(_intersects(key,replacement_positions[CURRENT_LEVEL][key],start,end)){return true}}return false}function _wrapCodeInSpan(name,code){return'<span class="'+name.replace(/\./g," ")+(global_class?" "+global_class:"")+'">'+code+"</span>"}function _indexOfGroup(match,group_number){var index=0,i;for(i=1;i<group_number;++i){if(match[i]){index+=match[i].length}}return index}function _processPattern(regex,pattern,code,callback){var match=regex.exec(code);if(!match){return callback()}++match_counter;if(!pattern["name"]&&typeof pattern["matches"][0]=="string"){pattern["name"]=pattern["matches"][0];delete pattern["matches"][0]}var replacement=match[0],start_pos=match.index,end_pos=match[0].length+start_pos,processNext=function(){var nextCall=function(){_processPattern(regex,pattern,code,callback)};return match_counter%100>0?nextCall():setTimeout(nextCall,0)};if(_matchIsInsideOtherMatch(start_pos,end_pos)){return processNext()}var onMatchSuccess=function(replacement){if(pattern["name"]){replacement=_wrapCodeInSpan(pattern["name"],replacement)}if(!replacements[CURRENT_LEVEL]){replacements[CURRENT_LEVEL]={};replacement_positions[CURRENT_LEVEL]={}}replacements[CURRENT_LEVEL][start_pos]={replace:match[0],"with":replacement};replacement_positions[CURRENT_LEVEL][start_pos]=end_pos;processNext()},group_keys=keys(pattern["matches"]),processGroup=function(i,group_keys,callback){if(i>=group_keys.length){return callback(replacement)}var processNextGroup=function(){processGroup(++i,group_keys,callback)},block=match[group_keys[i]];if(!block){return processNextGroup()}var group=pattern["matches"][group_keys[i]],language=group["language"],process_group=group["name"]&&group["matches"]?group["matches"]:group,_replaceAndContinue=function(block,replace_block,match_name){replacement=_replaceAtPosition(_indexOfGroup(match,group_keys[i]),block,match_name?_wrapCodeInSpan(match_name,replace_block):replace_block,replacement);processNextGroup()};if(language){return _highlightBlockForLanguage(block,language,function(code){_replaceAndContinue(block,code)})}if(typeof group==="string"){return _replaceAndContinue(block,block,group)}_processCodeWithPatterns(block,process_group.length?process_group:[process_group],function(code){_replaceAndContinue(block,code,group["matches"]?group["name"]:0)})};processGroup(0,group_keys,onMatchSuccess)}function _bypassDefaultPatterns(language){return bypass_defaults[language]}function _getPatternsForLanguage(language){var patterns=language_patterns[language]||[],default_patterns=language_patterns[DEFAULT_LANGUAGE]||[];return _bypassDefaultPatterns(language)?patterns:patterns.concat(default_patterns)}function _replaceAtPosition(position,replace,replace_with,code){var sub_string=code.substr(position);return code.substr(0,position)+sub_string.replace(replace,replace_with)}function keys(object){var locations=[],replacement,pos;for(var location in object){if(object.hasOwnProperty(location)){locations.push(location)}}return locations.sort(function(a,b){return b-a})}function _processCodeWithPatterns(code,patterns,callback){++CURRENT_LEVEL;function _workOnPatterns(patterns,i){if(i<patterns.length){return _processPattern(patterns[i]["pattern"],patterns[i],code,function(){_workOnPatterns(patterns,++i)})}_processReplacements(code,function(code){delete replacements[CURRENT_LEVEL];delete replacement_positions[CURRENT_LEVEL];--CURRENT_LEVEL;callback(code)})}_workOnPatterns(patterns,0)}function _processReplacements(code,onComplete){function _processReplacement(code,positions,i,onComplete){if(i<positions.length){++replacement_counter;var pos=positions[i],replacement=replacements[CURRENT_LEVEL][pos];code=_replaceAtPosition(pos,replacement["replace"],replacement["with"],code);var next=function(){_processReplacement(code,positions,++i,onComplete)};return replacement_counter%250>0?next():setTimeout(next,0)}onComplete(code)}var string_positions=keys(replacements[CURRENT_LEVEL]);_processReplacement(code,string_positions,0,onComplete)}function _highlightBlockForLanguage(code,language,onComplete){var patterns=_getPatternsForLanguage(language);_processCodeWithPatterns(_htmlEntities(code),patterns,onComplete)}function _highlightCodeBlock(code_blocks,i,onComplete){if(i<code_blocks.length){var block=code_blocks[i],language=_getLanguageForBlock(block);if(!_hasClass(block,"rainbow")&&language){language=language.toLowerCase();_addClass(block,"rainbow");return _highlightBlockForLanguage(block.innerHTML,language,function(code){block.innerHTML=code;replacements={};replacement_positions={};if(onHighlight){onHighlight(block,language)}setTimeout(function(){_highlightCodeBlock(code_blocks,++i,onComplete)},0)})}return _highlightCodeBlock(code_blocks,++i,onComplete)}if(onComplete){onComplete()}}function _highlight(node,onComplete){node=node&&typeof node.getElementsByTagName=="function"?node:document;var pre_blocks=node.getElementsByTagName("pre"),code_blocks=node.getElementsByTagName("code"),i,final_blocks=[];for(i=0;i<code_blocks.length;++i){final_blocks.push(code_blocks[i])}for(i=0;i<pre_blocks.length;++i){if(!pre_blocks[i].getElementsByTagName("code").length){final_blocks.push(pre_blocks[i])}}_highlightCodeBlock(final_blocks,0,onComplete)}return{extend:function(language,patterns,bypass){if(arguments.length==1){patterns=language;language=DEFAULT_LANGUAGE}bypass_defaults[language]=bypass;language_patterns[language]=patterns.concat(language_patterns[language]||[])},onHighlight:function(callback){onHighlight=callback},addClass:function(class_name){global_class=class_name},color:function(){if(typeof arguments[0]=="string"){return _highlightBlockForLanguage(arguments[0],arguments[1],arguments[2])}if(typeof arguments[0]=="function"){return _highlight(0,arguments[0])}_highlight(arguments[0],arguments[1])}}}();(function(){if(document.addEventListener){return document.addEventListener("DOMContentLoaded",Rainbow.color,false)}window.attachEvent("onload",Rainbow.color)})();Rainbow["onHighlight"]=Rainbow.onHighlight;Rainbow["addClass"]=Rainbow.addClass;